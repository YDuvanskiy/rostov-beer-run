<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–æ—Å—Ç–æ–≤—Å–∫–∏–π –ü–∏–≤–Ω–æ–π –ó–∞–±–µ–≥</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–≥—Ä—ã */
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Press Start 2P', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            font-size: 10px;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            border: 4px solid #d40000; /* –ë–æ–ª–µ–µ —è—Ä–∫–∞—è —Ä–∞–º–∫–∞ */
            box-shadow: 0 0 25px rgba(255, 50, 50, 0.7);
            background-color: #000;
            margin-bottom: 20px;
            overflow: hidden;
        }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        #header-bar {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 15px;
            background-color: #111;
            border: 2px solid #555;
            margin-bottom: 10px;
            box-sizing: border-box;
            border-radius: 5px;
        }

        .info-panel {
            font-size: 1.2em;
            color: #00ff00;
            text-shadow: 0 0 5px #00cc00; /* –Ø—Ä–∫–∏–π —Å–≤–µ—Ç—è—â–∏–π—Å—è —Ç–µ–∫—Å—Ç */
        }

        /* –ö–∞–Ω–≤–∞—Å */
        #game-canvas {
            display: block;
            background-color: #1a2a40; /* –ì–ª—É–±–æ–∫–æ–µ –Ω–æ—á–Ω–æ–µ –Ω–µ–±–æ */
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏ –¥–∏–∞–ª–æ–≥–æ–≤ */
        #intro-screen, #dialogue-overlay, #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 100;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–ò–ê–õ–û–ì–ê */
        #dialogue-overlay {
            background-color: rgba(0, 0, 0, 0.7); 
            display: none;
            flex-direction: column;
            justify-content: space-between; /* –î–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏–∫–æ–Ω–æ–∫ */
            padding: 0;
        }

        /* –ö–û–ù–¢–ï–ô–ù–ï–† –¢–ï–ö–°–¢–ê –î–ò–ê–õ–û–ì–ê */
        #dialogue-box {
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        
        #dialogue-text-content {
            border: 3px solid #00ff00;
            background-color: #050505;
            padding: 15px;
            width: 90%;
            min-height: 80px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            line-height: 1.4;
            font-size: 1.1em;
        }

        #typewriter-text {
            white-space: pre-wrap;
            min-height: 200px;
            text-align: center;
            line-height: 1.6;
            color: #fff;
        }

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ò–ö–û–ù–û–ö –ü–ï–†–°–û–ù–ê–ñ–ï–ô */
        .speaker-icon {
            position: absolute;
            bottom: 40px; /* –ù–∞–¥ –ª–∏–Ω–∏–µ–π –∑–µ–º–ª–∏ */
            width: 100px;
            height: 100px;
            font-size: 60px;
            text-align: center;
            line-height: 100px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.5)); /* –°–≤–µ—Ç—è—â–∏–π—Å—è —ç—Ñ—Ñ–µ–∫—Ç */
            transition: opacity 0.3s;
            pointer-events: none;
            user-select: none;
        }
        
        #speaker-left {
            left: 50px;
            color: #e6b800; /* –¶–≤–µ—Ç –Æ—Ä–∏—è */
        }
        
        #speaker-right {
            right: 50px;
            color: #00ff00; /* –¶–≤–µ—Ç –°–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ */
        }

        /* –ö–Ω–æ–ø–∫–∞ */
        .game-button {
            padding: 12px 25px;
            margin-top: 30px;
            font-size: 1.6em;
            font-family: 'Press Start 2P', monospace;
            cursor: pointer;
            background-color: #d40000;
            color: #fff;
            border: 4px solid #ff5555;
            border-radius: 5px;
            box-shadow: 0 6px 0 #8b0000;
            transition: all 0.1s;
        }

        .game-button:hover {
            background-color: #ff5555;
            box-shadow: 0 4px 0 #8b0000;
            transform: translateY(2px);
        }
        
        .game-button:active {
            box-shadow: 0 0 0 #8b0000;
            transform: translateY(6px);
        }

    </style>
</head>
<body>

    <div id="header-bar">
        <div class="info-panel">–í—Ä–µ–º—è: <span id="time-display">22:59:00:00</span></div>
        <div class="info-panel">–ö–æ–Ω—Ñ–µ—Ç—ã: <span id="candy-display">0</span></div>
    </div>

    <div id="game-container">
        <canvas id="game-canvas"></canvas>

        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="intro-screen">
            <!-- –ö–ù–û–ü–ö–ê –î–õ–Ø –ê–ö–¢–ò–í–ê–¶–ò–ò –ó–í–£–ö–ê –ò –ù–ê–ß–ê–õ–ê –í–°–¢–£–ü–õ–ï–ù–ò–Ø -->
            <button id="pre-start-button" class="game-button">–ù–ê–ß–ê–¢–¨</button>
            <pre id="typewriter-text" style="display: none;"></pre>
            <button id="start-button" class="game-button" style="display: none;">–°–¢–ê–†–¢</button>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π –î–∏–∞–ª–æ–≥–∞ (–≤–∫–ª—é—á–∞–µ—Ç –∏–∫–æ–Ω–∫–∏) -->
        <div id="dialogue-overlay" style="display: none;">
            
            <!-- –ò–∫–æ–Ω–∫–∞ –Æ—Ä–∏—è (—Å–ª–µ–≤–∞) -->
            <div id="speaker-left" class="speaker-icon" style="opacity: 0;">üë®</div> 
            
            <!-- –ò–∫–æ–Ω–∫–∞ –°–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ (—Å–ø—Ä–∞–≤–∞) -->
            <div id="speaker-right" class="speaker-icon" style="opacity: 0;"></div> 
            
            <div id="dialogue-box">
                <div id="dialogue-text-content"></div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
        <div id="game-over-screen" style="display: none;">
            <h1 id="game-over-message" style="font-size: 2em; color: #ff0000; text-align: center;"></h1>
            <button class="game-button" onclick="window.location.reload()">–ù–ê–ß–ê–¢–¨ –°–ù–û–í–ê</button>
        </div>

    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∏–≥—Ä–æ–∫–∞ -->
    <div style="margin-top: 10px; font-size: 0.9em; text-align: center; color: #aaa;">
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: [–ü–†–û–ë–ï–õ] - –ü—Ä—ã–∂–æ–∫.
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Canvas
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 400;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const introScreen = document.getElementById('intro-screen');
        const preStartButton = document.getElementById('pre-start-button');
        const typewriterTextElement = document.getElementById('typewriter-text');
        const startButton = document.getElementById('start-button');
        const timeDisplay = document.getElementById('time-display');
        const candyDisplay = document.getElementById('candy-display');
        const dialogueOverlay = document.getElementById('dialogue-overlay'); 
        const dialogueTextContent = document.getElementById('dialogue-text-content'); 
        const gameOverScreen = document.getElementById('game-over-screen');
        const gameOverMessage = document.getElementById('game-over-message');
        const speakerLeft = document.getElementById('speaker-left'); 
        const speakerRight = document.getElementById('speaker-right'); 


        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            isRunning: false, // –§–ª–∞–≥ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è/–∫–æ–ª–ª–∏–∑–∏–π
            isDialogue: false, // –§–ª–∞–≥ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
            distance: 0,
            yuri: { x: 50, y: 0, width: 30, height: 60, dy: 0, onGround: true, isSlowing: false },
            groundY: GAME_HEIGHT - 40,
            baseSpeed: 180, 
            currentSpeed: 180,
            candyCount: 0,
            startTime: null,
            timerInterval: null,
            lastTime: 0,
            gameOver: false,
            runFrame: 0, 
            animationTimer: 0,
            frameDuration: 0.1, 
        };

        const GAME_END_DISTANCE = 10000; // –¶–µ–ª–µ–≤–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è
        const MAX_TIME_MS = 60000; // 60 —Å–µ–∫—É–Ω–¥ (–¥–æ 23:00)
        const SPEAKER_ICONS = {
            "–Æ—Ä–∏–π": { icon: "üë®", side: "left" },
            "–ï–≤–≥–µ–Ω–∏–π –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á": { icon: "üë¥", side: "right" } 
        };

        const objects = [];

        // --- –ó–í–£–ö–û–í–´–ï –£–¢–ò–õ–ò–¢–´ (Typewriter Click) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioContext;
        let isAudioReady = false;

        function initAudio() {
            if (!audioContext) {
                audioContext = new AudioContext();
                isAudioReady = true;
            }
        }

        // –†–µ—Ç—Ä–æ-–±–ª–∏–ø
        function playTypewriterSound() {
            if (!isAudioReady) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine'; 
            const baseFreq = 400 + Math.random() * 50;
            
            gainNode.gain.setValueAtTime(0.0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.005);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.08);

            oscillator.frequency.setValueAtTime(baseFreq, audioContext.currentTime);
            oscillator.frequency.linearRampToValueAtTime(baseFreq * 0.8, audioContext.currentTime + 0.04);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // --- TYPEWRITER EFFECT / –î–ò–ê–õ–û–ì–ò ---
        async function typewriterEffect(element, fullText, speed = 30) {
            element.innerHTML = '';
            for (let i = 0; i < fullText.length; i++) {
                if (gameState.isDialogue || !gameState.isRunning) {
                     if (fullText[i] !== '\n' && fullText[i] !== ' ') {
                        playTypewriterSound();
                    }
                }
                element.innerHTML += fullText[i];
                await new Promise(resolve => setTimeout(resolve, speed));
            }
        }
        
        function updateSpeakerIcons(speaker) {
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫
            speakerLeft.style.opacity = 0;
            speakerRight.style.opacity = 0;
            speakerRight.textContent = '';

            if (speaker) {
                const config = SPEAKER_ICONS[speaker];
                if (config) {
                    if (config.side === 'left') {
                        speakerLeft.style.opacity = 1;
                    } else if (config.side === 'right') {
                        speakerRight.textContent = config.icon;
                        speakerRight.style.opacity = 1;
                        // –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Æ—Ä–∏—è, —á—Ç–æ–±—ã –æ–Ω —Å–º–æ—Ç—Ä–µ–ª –Ω–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
                        speakerLeft.style.opacity = 1; 
                    }
                }
            }
        }

        async function showDialogue(speaker, text, onEndCallback = () => {}) {
            // isRunning = false; —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞/–º–∏—Ä–∞
            gameState.isRunning = false;
            gameState.isDialogue = true;
            dialogueOverlay.style.display = 'flex';
            
            updateSpeakerIcons(speaker);
            
            const fullText = speaker ? `${speaker}: \n${text}` : text;
            
            await typewriterEffect(dialogueTextContent, fullText, 50);

            const continueButton = document.createElement('button');
            continueButton.className = 'game-button';
            continueButton.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
            
            const buttonContainer = document.createElement('div');
            buttonContainer.style.textAlign = 'center';
            buttonContainer.appendChild(continueButton);
            dialogueTextContent.appendChild(buttonContainer);


            continueButton.onclick = () => {
                dialogueOverlay.style.display = 'none';
                dialogueTextContent.innerHTML = '';
                gameState.isDialogue = false;
                gameState.isRunning = true;
                
                updateSpeakerIcons(null); 
                
                onEndCallback();
            };
        }

        const dialogues = [
            {
                distance: 3500,
                speaker: "–ï–≤–≥–µ–Ω–∏–π –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á",
                // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç –ï–≤–≥–µ–Ω–∏—è –∏ –û–ª–µ–≥–∞
                text: "–ó–¥–æ—Ä–æ–≤–æ, –Æ—Ä–∞! –ö—É–¥–∞ —ç—Ç–æ —Ç—ã –Ω–∞ –Ω–æ—á—å –≥–ª—è–¥—è? –¢—É–º–∞–Ω —Å–µ–≥–æ–¥–Ω—è, –∞–∂ —Å–≥—É—â–∞–µ—Ç —Ç–æ—Å–∫—É. –ù–∞—à –ú–∏—Ö–∞–∏–ª –≤–æ–Ω –æ–ø—è—Ç—å –Ω–∞ —Å–≤–æ–µ–π '–í–æ–ª–≥–µ' –∑–∞—Å—Ç—Ä—è–ª, –∞ –ê–ª–µ–∫—Å–µ–π —Å —É—Ç—Ä–∞ –∫—Ä–∏—á–∞–ª, —á—Ç–æ –ø–∏–≤–æ –∫–æ–Ω—á–∏–ª–æ—Å—å. –•–∞-—Ö–∞! –ö—Å—Ç–∞—Ç–∏, –∞–Ω–µ–∫–¥–æ—Ç –≤ —Ç–µ–º—É: '–ò–¥—ë—Ç –º—É–∂–∏–∫ –ø–æ —Ç—É–º–∞–Ω—É, –∞ –Ω–∞–≤—Å—Ç—Ä–µ—á—É –µ–º—É ‚Äî —Å–æ–±–∞–∫–∞. –ú—É–∂–∏–∫: '–¢—ã –∫—Ç–æ?' –°–æ–±–∞–∫–∞: '–ì–∞–≤-–≥–∞–≤!' –ú—É–∂–∏–∫: '–û—Ö, –∫–∞–∫ —Ö–æ—Ä–æ—à–æ, —á—Ç–æ —Ç—ã —Å—Ä–∞–∑—É —Å–∫–∞–∑–∞–ª! –Ø-—Ç–æ –¥—É–º–∞–ª, —Ç—ã –µ–∂!' [–ü—Ä–æ—á–∏—Å—Ç–∏–≤ –≥–æ—Ä–ª–æ, –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç, –Ω–µ –¥–∞–≤–∞—è –Æ—Ä–∏—é –∏ —Å–ª–æ–≤–∞ —Å–∫–∞–∑–∞—Ç—å]: –ê —Ç—ã –∑–Ω–∞–µ—à—å, —Ç—É—Ç –û–ª–µ–≥ —Å–≤–æ–π –Ω–æ–≤—ã–π '–ß–µ—Ä–∏ –¢–∏–≥–≥–æ' –≤—ã–∫–∞—Ç–∏–ª. –ö–∏—Ç–∞–π—Ü—ã, –∫–æ–Ω–µ—á–Ω–æ, —É–¥–∏–≤–ª—è—é—Ç. –†–∞–Ω—å—à–µ '–ñ–∏–≥—É–ª–∏' –±—ã–ª–∏, –∞ —Ç–µ–ø–µ—Ä—å –≤–æ—Ç, —É –Ω–∏—Ö –∫—Ä–æ—Å—Å–æ–≤–µ—Ä—ã.  –î–∞ –æ–Ω–∏ –≤–µ—Å—å –º–∏—Ä –∑–∞—Ö–≤–∞—Ç—è—Ç! –í–∑—è—Ç—å —Ö–æ—Ç—å —ç–∫–æ–Ω–æ–º–∏–∫—É. –≠—Ç–æ –∫–∞–∫ **–≤–æ–ª–Ω–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç**. –¢—ã –±—Ä–æ—Å–∞–µ—à—å –∫–∞–º–µ–Ω—å, –∏ –≤–æ–ª–Ω—ã —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è. –¢–∞–∫ –∂–µ –∏ —Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ ‚Äî –æ–¥–∏–Ω –ø—Ä–æ—Ä—ã–≤, –∏ –≤—Å–µ –º–µ–Ω—è–µ—Ç—Å—è. –í–æ—Ç –∏ –∫–∏—Ç–∞–π—Å–∫–∏–µ –º–∞—à–∏–Ω—ã ‚Äî —ç—Ç–æ —É–∂–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–∞—à–∏–Ω—ã, —ç—Ç–æ –∫—É–ª—å—Ç—É—Ä–Ω–∞—è –≤–æ–ª–Ω–∞. –ü–æ–Ω–∏–º–∞–µ—à—å? –≠—Ç–æ –∂–µ –∫–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π **–∫—Ä–µ–º-–±—Ä—é–ª–µ**!  –¢—ã –¥—É–º–∞–µ—à—å, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ? –ù–µ—Ç! –ù—É–∂–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–º–µ—à–∞—Ç—å —Å–ª–∏–≤–∫–∏, –∂–µ–ª—Ç–∫–∏ –∏ —Å–∞—Ö–∞—Ä, –Ω–∞–≥—Ä–µ—Ç—å –¥–æ –Ω—É–∂–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –∞ –ø–æ—Ç–æ–º —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –∫–∞—Ä–∞–º–µ–ª—å–Ω–∞—è –∫–æ—Ä–æ—á–∫–∞. –≠—Ç–æ, –Æ—Ä–∞, –∏ –µ—Å—Ç—å —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∂–∏–∑–Ω–∏: —Å–ª–∞–¥–∫–æ–µ –≤–Ω—É—Ç—Ä–∏ –∏ —Ö—Ä—É—Å—Ç–∫–∞—è –∑–∞—â–∏—Ç–∞ —Å–Ω–∞—Ä—É–∂–∏. –õ–∞–¥–Ω–æ, –±–µ–≥–∏, —Ç–µ–±–µ –Ω–µ–ª—å–∑—è –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è, –≤—Ä–µ–º—è-—Ç–æ! –£–¥–∞—á–∏!",
                done: false
            }
        ];

        // --- –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ---
        
        function drawYuri() {
            const yuri = gameState.yuri;
            const color = yuri.isSlowing ? '#ff0000' : '#e6b800'; 
            
            ctx.fillStyle = color;
            
            // –ì–æ–ª–æ–≤–∞ (–∫–≤–∞–¥—Ä–∞—Ç –¥–ª—è —Ä–µ—Ç—Ä–æ-—Å—Ç–∏–ª—è)
            ctx.fillRect(yuri.x + 5, yuri.y, yuri.width - 10, 10);
            
            // –¢–µ–ª–æ
            ctx.fillRect(yuri.x, yuri.y + 10, yuri.width, yuri.height - 20);

            // –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –±–µ–≥–∞ (–Ω–æ–≥–∏)
            const legColor = '#333'; 
            const legWidth = 8;
            const legHeight = 20;

            if (yuri.onGround) {
                // –ù–æ–≥–∞ 1 (–ø–µ—Ä–µ–¥–Ω—è—è)
                ctx.fillStyle = legColor;
                if (gameState.runFrame === 0) {
                     ctx.fillRect(yuri.x + 5, yuri.y + yuri.height - legHeight, legWidth, legHeight);
                     ctx.fillRect(yuri.x + yuri.width - legWidth - 5, yuri.y + yuri.height - legHeight + 5, legWidth, legHeight - 5);
                } else {
                     ctx.fillRect(yuri.x + 5, yuri.y + yuri.height - legHeight + 5, legWidth, legHeight - 5);
                     ctx.fillRect(yuri.x + yuri.width - legWidth - 5, yuri.y + yuri.height - legHeight, legWidth, legHeight);
                }
            } else {
                // –ù–æ–≥–∏ –≤ –ø—Ä—ã–∂–∫–µ
                ctx.fillRect(yuri.x + 5, yuri.y + yuri.height - legHeight + 10, legWidth, legHeight - 10);
                ctx.fillRect(yuri.x + yuri.width - legWidth - 5, yuri.y + yuri.height - legHeight + 10, legWidth, legHeight - 10);
            }
        }

        let backgroundOffset = 0;
        const groundLevel = GAME_HEIGHT - 40;
        
        function drawBackground(deltaTime) {
            // –§–æ–Ω (–ì—Ä–∞–¥–∏–µ–Ω—Ç –ù–æ—á–Ω–æ–≥–æ –ù–µ–±–∞)
            const skyGradient = ctx.createLinearGradient(0, 0, 0, groundLevel);
            skyGradient.addColorStop(0, '#1a2a40'); 
            skyGradient.addColorStop(1, '#3c5a75');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, GAME_WIDTH, groundLevel);

            // –°–¥–≤–∏–≥ —Ñ–æ–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞ (—Ç.–µ. –Æ—Ä–∏–π –±–µ–∂–∏—Ç)
            if (gameState.isRunning && !gameState.isDialogue) {
                const scrollX = gameState.currentSpeed * deltaTime;
                backgroundOffset = (backgroundOffset + scrollX) % 1000; 
            }


            // –ó–µ–º–ª—è (–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞)
            ctx.fillStyle = '#222'; 
            ctx.fillRect(0, groundLevel, GAME_WIDTH, GAME_HEIGHT - groundLevel);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—É—Ä—É –∑–µ–º–ª–µ (–ª–∏–Ω–∏–∏)
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for(let i = 0; i < GAME_WIDTH; i += 50) {
                 ctx.moveTo(i - backgroundOffset * 0.5, groundLevel);
                 ctx.lineTo(i - backgroundOffset * 0.5 + 20, groundLevel + 10);
            }
            ctx.stroke();


            // –ü—Ä–æ—Å—Ç—ã–µ –¥–æ–º–∏–∫–∏ –∏ –¥–µ—Ä–µ–≤—å—è (—Å–¥–≤–∏–≥ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞ –∏ —Å–∏–ª—É—ç—Ç–æ–≤)
            const drawParallaxElement = (x, y, width, height, color) => {
                ctx.fillStyle = color;
                ctx.fillRect(x, y, width, height);
                // –î–æ–±–∞–≤–∏–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—É—é "–ª—É–Ω—É" –∏–ª–∏ "—Ñ–æ–Ω–∞—Ä—å" –≤ –æ–∫–Ω–µ
                if (height > 50) {
                     ctx.fillStyle = '#ffcc00';
                     ctx.fillRect(x + width * 0.7, y + 10, 5, 5);
                }
            };
            
            // –°–ª–æ–π 1: –î–∞–ª–µ–∫–∏–µ –¥–µ—Ä–µ–≤—å—è (0.1x —Å–∫–æ—Ä–æ—Å—Ç—å)
            const farColor = '#2d3e4c';
            for (let i = -1; i < (GAME_WIDTH / 100) + 1; i++) {
                const x = ((i * 150) - (backgroundOffset * 0.1)) % (GAME_WIDTH + 150);
                if (x < GAME_WIDTH) {
                    drawParallaxElement(x, groundLevel - 30, 20, 30, farColor);
                }
            }
            
            // –°–ª–æ–π 2: –î–æ–º–∏–∫–∏ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ (0.3x —Å–∫–æ—Ä–æ—Å—Ç—å)
            const midColor = '#4a627a';
            for (let i = -1; i < (GAME_WIDTH / 100) + 1; i++) {
                const x = ((i * 200) - (backgroundOffset * 0.3)) % (GAME_WIDTH + 200);
                if (x < GAME_WIDTH) {
                    drawParallaxElement(x, groundLevel - 70, 60, 70, midColor);
                }
            }
            
            // –°–ª–æ–π 3: –ë–ª–∏–∂–Ω–∏–µ —Ñ–æ–Ω–∞—Ä–∏/–¥–µ—Ä–µ–≤—å—è (0.6x —Å–∫–æ—Ä–æ—Å—Ç—å)
            const nearColor = '#5e7b99';
            for (let i = -1; i < (GAME_WIDTH / 100) + 1; i++) {
                const x = ((i * 300) - (backgroundOffset * 0.6)) % (GAME_WIDTH + 300);
                if (x < GAME_WIDTH) {
                    drawParallaxElement(x, groundLevel - 50, 10, 50, nearColor);
                }
            }

            // –≠—Ñ—Ñ–µ–∫—Ç —Ç—É–º–∞–Ω–∞ (–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å–ª–æ–π)
            ctx.fillStyle = 'rgba(60, 90, 120, 0.4)'; 
            ctx.fillRect(0, groundLevel - 100, GAME_WIDTH, 100); 
            ctx.fillStyle = 'rgba(60, 90, 120, 0.6)'; 
            ctx.fillRect(0, groundLevel - 20, GAME_WIDTH, 20); 
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
        function drawObject(obj) {
            // –û–±—ä–µ–∫—Ç—ã —Ä–∏—Å—É—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–º–µ—â–µ–Ω–∏—è –Æ—Ä–∏—è
            const xPos = obj.x - gameState.distance;

            if (xPos + obj.width < 0 || xPos > GAME_WIDTH) return;

            ctx.font = '28px "Press Start 2P"';
            ctx.textAlign = 'center';
            
            switch (obj.type) {
                case 'candy':
                    ctx.fillStyle = '#ff88ff';
                    ctx.beginPath();
                    ctx.arc(xPos + obj.width / 2, obj.y + obj.height / 2, obj.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#fff';
                    ctx.fillText('üç¨', xPos + obj.width / 2, obj.y + obj.height - 2);
                    break;
                
                case 'trash':
                    ctx.fillStyle = '#6b7a8c'; 
                    ctx.fillRect(xPos, obj.y, obj.width, obj.height);
                    ctx.fillStyle = '#3f4b59'; 
                    ctx.fillRect(xPos - 2, obj.y, obj.width + 4, 5);
                    ctx.fillStyle = '#fff';
                    ctx.fillText('üóëÔ∏è', xPos + obj.width / 2, obj.y + obj.height - 5);
                    break;
                
                case 'dog':
                    ctx.fillStyle = '#b8860b'; 
                    ctx.fillRect(xPos, obj.y + 10, obj.width, obj.height - 10); 
                    ctx.beginPath();
                    ctx.arc(xPos + obj.width, obj.y + 10, 5, 0, Math.PI * 2); 
                    ctx.fill();
                    ctx.fillStyle = '#fff';
                    ctx.fillText('üêï', xPos + obj.width / 2, obj.y + obj.height - 5);
                    break;
                    
                case 'bum':
                    ctx.fillStyle = '#708090'; 
                    ctx.fillRect(xPos, obj.y, obj.width, obj.height);
                    ctx.fillStyle = '#fce4c4';
                    ctx.fillRect(xPos + 5, obj.y + 5, 25, 20); 
                    ctx.fillStyle = '#fff';
                    ctx.fillText('üßî', xPos + obj.width / 2, obj.y + obj.height - 5);
                    break;

                case 'stall':
                    // –ü–∏–≤–Ω–æ–π –õ–∞—Ä–µ–∫
                    ctx.fillStyle = '#ffc300'; 
                    ctx.fillRect(xPos, obj.y, obj.width, obj.height);
                    ctx.fillStyle = '#8b0000'; 
                    ctx.fillRect(xPos, obj.y, obj.width, 10);
                    ctx.fillStyle = '#fff';
                    ctx.font = '10px "Press Start 2P"';
                    ctx.fillText('–ü–ò–í–û', xPos + obj.width / 2, obj.y + 8);
                    ctx.fillText('üçª', xPos + obj.width / 2, obj.y + obj.height - 15);
                    break;
                    
                 case 'neighbor':
                     ctx.fillStyle = '#00ff00'; 
                     ctx.fillRect(xPos, obj.y, obj.width, obj.height);
                     ctx.fillStyle = '#fff';
                     // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–∫–æ–Ω–∫—É –ï–≤–≥–µ–Ω–∏—è
                     ctx.fillText('üë¥', xPos + obj.width / 2, obj.y + obj.height - 5); 
                     break;
            }
        }

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–û–ú ---
        function handleJump() {
            if (gameState.yuri.onGround && gameState.isRunning) {
                gameState.yuri.dy = -15; // –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä—ã–∂–∫–∞
                gameState.yuri.onGround = false;
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                handleJump();
            }
        });

        // --- –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø (GAME LOOP) ---
        function update(deltaTime) {
            // –î–≤–∏–∂–µ–Ω–∏–µ –∏ –∫–æ–ª–ª–∏–∑–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ RUNNING –∏ –Ω–µ –≤ DIALOGUE
            if (!gameState.isRunning || gameState.gameOver || gameState.isDialogue) return;

            // 1. –î–≤–∏–∂–µ–Ω–∏–µ –∏ –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –Æ—Ä–∏—è
            gameState.yuri.y += gameState.yuri.dy;
            gameState.yuri.dy += 0.6; // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏—è
            if (gameState.yuri.y + gameState.yuri.height >= gameState.groundY) {
                gameState.yuri.y = gameState.groundY - gameState.yuri.height;
                gameState.yuri.dy = 0;
                gameState.yuri.onGround = true;
            }
            
            // 2. –ê–Ω–∏–º–∞—Ü–∏—è –±–µ–≥–∞
            if (gameState.yuri.onGround) {
                gameState.animationTimer += deltaTime;
                if (gameState.animationTimer >= gameState.frameDuration) {
                    gameState.runFrame = 1 - gameState.runFrame; // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º 0 <-> 1
                    gameState.animationTimer = 0;
                }
            }
            
            // 3. –†–∞—Å—á–µ—Ç —Å–¥–≤–∏–≥–∞ –∏ –î–∏—Å—Ç–∞–Ω—Ü–∏–∏
            const distanceMoved = gameState.currentSpeed * deltaTime;
            gameState.distance += distanceMoved;

            // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–∏–∞–ª–æ–≥–æ–≤ 
            dialogues.forEach(d => {
                if (!d.done && gameState.distance >= d.distance - GAME_WIDTH / 2) {
                    d.done = true;
                    // –ò—â–µ–º —Å–æ—Å–µ–¥–∞, —á—Ç–æ–±—ã –µ–≥–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –¥–∏–∞–ª–æ–≥–∞
                    const neighborIndex = objects.findIndex(obj => 
                        obj.type === 'neighbor' && 
                        Math.abs(obj.worldDistance - d.distance) < 50 
                    );
                    
                    showDialogue(d.speaker, d.text, () => {
                        if (neighborIndex !== -1) {
                            objects.splice(neighborIndex, 1);
                        }
                    });
                }
            });

            // 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –û–±—ä–µ–∫—Ç–æ–≤ –∏ –ö–æ–ª–ª–∏–∑–∏–π
            for (let i = 0; i < objects.length; i++) {
                const obj = objects[i];
                // –°–¥–≤–∏–≥ –æ–±—ä–µ–∫—Ç–∞ (–≤–∏–∑—É–∞–ª—å–Ω–æ)
                obj.x -= distanceMoved;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–∏ –Æ—Ä–∏—è –∏ –û–±—ä–µ–∫—Ç–∞
                if (obj.type !== 'stall' && obj.type !== 'neighbor' && 
                    obj.x < gameState.yuri.x + gameState.yuri.width &&
                    obj.x + obj.width > gameState.yuri.x &&
                    obj.y < gameState.yuri.y + gameState.yuri.height &&
                    obj.y + obj.height > gameState.yuri.y) {
                    
                    let collisionHandled = false;

                    switch (obj.type) {
                        case 'candy':
                            gameState.candyCount++;
                            candyDisplay.textContent = gameState.candyCount;
                            collisionHandled = true; 
                            break;
                        
                        case 'dog':
                        case 'bum':
                            if (gameState.candyCount > 0) {
                                gameState.candyCount--;
                                candyDisplay.textContent = gameState.candyCount;
                            } else {
                                applySlowdown(1.5); 
                            }
                            collisionHandled = true; 
                            break;

                        case 'trash':
                            applySlowdown(2.5); 
                            gameState.currentSpeed *= 0.8; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
                            collisionHandled = true; 
                            break;
                    }
                    
                    if (collisionHandled) {
                        objects.splice(i, 1);
                        i--; 
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã (—Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –ª–∞—Ä—å–∫–æ–º)
                if (obj.type === 'stall' && 
                    obj.x < gameState.yuri.x + gameState.yuri.width &&
                    obj.x + obj.width > gameState.yuri.x) {
                    endGame("–£—Å–ø–µ–ª! –ü–∏–≤–æ –Ω–∞–π–¥–µ–Ω–æ! –ü–û–ë–ï–î–ê!");
                    return;
                }
            }

            // –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –≤—ã—à–µ–¥—à–∏—Ö –∑–∞ —ç–∫—Ä–∞–Ω
            objects.filter(obj => (obj.x + obj.width) > 0);

            // 6. –°–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (—Å–ª—É—á–∞–π–Ω–æ)
            spawnObjects(distanceMoved);
        }

        // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
        let slowdownTimeout = null;
        function applySlowdown(durationSeconds) {
            if (slowdownTimeout) clearTimeout(slowdownTimeout);
            
            gameState.currentSpeed = gameState.baseSpeed * 0.3; 
            gameState.yuri.isSlowing = true;
            
            slowdownTimeout = setTimeout(() => {
                gameState.currentSpeed = gameState.baseSpeed;
                gameState.yuri.isSlowing = false;
                slowdownTimeout = null;
            }, durationSeconds * 1000);
        }

        // –õ–æ–≥–∏–∫–∞ —Å–ø–∞–≤–Ω–∞
        let lastObjectX = GAME_WIDTH;
        function spawnObjects(distanceMoved) {
            // –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            lastObjectX -= distanceMoved;
            
            // –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—ä–µ–∫—Ç —É—à–µ–ª –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–ª–µ–∫–æ
            if (lastObjectX < GAME_WIDTH - Math.random() * 800 - 300) {
                const rand = Math.random();
                let type;
                let width, height, color;

                if (rand < 0.3) {
                    type = 'candy'; width = 20; height = 20; color = '#ff88ff'; 
                } else if (rand < 0.5) {
                    type = 'trash'; width = 40; height = 40; color = '#888'; 
                } else if (rand < 0.75) {
                    type = 'dog'; width = 50; height = 30; color = '#b8860b'; 
                } else {
                    type = 'bum'; width = 35; height = 55; color = '#708090'; 
                }

                // –û–±—ä–µ–∫—Ç—ã –Ω–∞ –∑–µ–º–ª–µ
                const y = gameState.groundY - height;
                
                const newObject = {
                    x: GAME_WIDTH + gameState.distance, 
                    y: y,
                    width: width,
                    height: height,
                    type: type,
                    color: color,
                    worldDistance: gameState.distance + GAME_WIDTH 
                };

                objects.push(newObject);
                lastObjectX = GAME_WIDTH;
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ì–†–û–ô ---

        function startGame() {
            canvas.width = GAME_WIDTH;
            canvas.height = GAME_HEIGHT;

            introScreen.style.display = 'none';
            gameState.isRunning = true;
            gameState.gameOver = false;
            gameState.startTime = Date.now();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ —Å–æ—Å–µ–¥–∞ (—Ç–æ–ª—å–∫–æ –ï–≤–≥–µ–Ω–∏–π)
            objects.push({
                x: GAME_WIDTH + 3500 - gameState.distance,
                y: gameState.groundY - 60,
                width: 40,
                height: 60,
                type: 'neighbor',
                color: '#00ff00',
                worldDistance: 3500
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∏–≤–Ω–æ–π –ª–∞—Ä–µ–∫ –≤ –∫–æ–Ω–µ—Ü
            objects.push({
                x: GAME_WIDTH + GAME_END_DISTANCE - gameState.distance,
                y: gameState.groundY - 70,
                width: 70,
                height: 70,
                type: 'stall',
                color: '#ffc300',
                worldDistance: GAME_END_DISTANCE
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
            gameLoop(0);
        }

        function endGame(message) {
            gameState.isRunning = false;
            gameState.gameOver = true;
            
            gameOverMessage.textContent = message;
            gameOverScreen.style.display = 'flex';
        }

        // --- –í–†–ï–ú–Ø ---
        function updateTimeDisplay(elapsedMs) {
            const totalMs = MAX_TIME_MS - (MAX_TIME_MS - elapsedMs);
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º 22:59:00:000 –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É
            const startTimeStamp = new Date().setHours(22, 59, 0, 0); 
            const currentMs = startTimeStamp + totalMs;
            const date = new Date(currentMs);

            const hh = String(date.getHours()).padStart(2, '0');
            const mm = String(date.getMinutes()).padStart(2, '0');
            const ss = String(date.getSeconds()).padStart(2, '0');
            // –î–µ—Å—è—Ç—ã–µ –∏ —Å–æ—Ç—ã–µ –¥–æ–ª–∏ —Å–µ–∫—É–Ω–¥—ã
            const dd = String(Math.floor(date.getMilliseconds() / 10)).padStart(2, '0');

            timeDisplay.textContent = `${hh}:${mm}:${ss}:${dd}`;
        }

        // --- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ ---
        function draw() {
            // –û—á–∏—Å—Ç–∫–∞
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            drawBackground(0); 
            objects.forEach(drawObject); 
            drawYuri(); 
        }

        function gameLoop(timestamp) {
            if (gameState.lastTime === 0) gameState.lastTime = timestamp; 
            
            const deltaTime = (timestamp - gameState.lastTime) / 1000; 
            gameState.lastTime = timestamp;

            // 1. –ü–†–û–í–ï–†–ö–ê –í–†–ï–ú–ï–ù–ò (–†–ê–ë–û–¢–ê–ï–¢ –í–°–ï–ì–î–ê, –î–ê–ñ–ï –í–û –í–†–ï–ú–Ø –î–ò–ê–õ–û–ì–ê)
            if (!gameState.gameOver && gameState.startTime) {
                const elapsed = Date.now() - gameState.startTime;
                
                if (elapsed >= MAX_TIME_MS) {
                    endGame("–ù–µ —É—Å–ø–µ–ª! –õ–∞—Ä—ë–∫ –∑–∞–∫—Ä—ã–ª—Å—è!");
                } else {
                    updateTimeDisplay(elapsed);
                }
            }
            
            // 2. –û–ë–ù–û–í–õ–ï–ù–ò–ï –õ–û–ì–ò–ö–ò –î–í–ò–ñ–ï–ù–ò–Ø/–ö–û–õ–õ–ò–ó–ò–ô (–¢–û–õ–¨–ö–û –ï–°–õ–ò RUNNING)
            if (gameState.isRunning) {
                update(deltaTime);
            }
            
            // 3. –û–¢–†–ò–°–û–í–ö–ê
            draw();

            if (!gameState.gameOver) {
                requestAnimationFrame(gameLoop);
            }
        }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        async function initialize() {
            const now = new Date();
            const dateString = `${String(now.getDate()).padStart(2, '0')}.${String(now.getMonth() + 1).padStart(2, '0')}.${now.getFullYear()}`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–∏–∫—Å–µ–ª–µ–π
            const introText = `[${dateString}] –≤—Ä–µ–º—è 22:59. –ì–¥–µ-—Ç–æ –Ω–∞ –æ–∫—Ä–∞–∏–Ω–µ –†–æ—Å—Ç–æ–≤–∞ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –ø–∏–≤–æ. –Æ—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—É—Ç—å.

            --- –ü–†–ê–í–ò–õ–ê –ò–ì–†–´ ---
            –¶–ï–õ–¨: –î–æ–±—Ä–∞—Ç—å—Å—è –¥–æ –ø–∏–≤–Ω–æ–≥–æ –ª–∞—Ä—å–∫–∞ –¥–æ 23:00.
            –£–ü–†–ê–í–õ–ï–ù–ò–ï: [–ü–†–û–ë–ï–õ] - –ü—Ä—ã–∂–æ–∫.
            –í–°–¢–†–ï–ß–ò: –°–æ–±–∞–∫–∏ üêï –∏ –ë–æ–º–∂–∏ üßî. –ò–º –Ω—É–∂–Ω—ã –∫–æ–Ω—Ñ–µ—Ç—ã üç¨, –∏–Ω–∞—á–µ –æ–Ω–∏ –≤–∞—Å –∑–∞–º–µ–¥–ª—è—Ç.
            –û–ü–ê–°–ù–û–°–¢–ò: –ú—É—Å–æ—Ä–Ω—ã–µ –±–∞–∫–∏ üóëÔ∏è. –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤–∞—Å.
            –í–†–ï–ú–Ø: –í—Ä–µ–º—è –Ω–µ—É–º–æ–ª–∏–º–æ!
            `;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è "–ù–ê–ß–ê–¢–¨"
            preStartButton.addEventListener('click', async () => {
                preStartButton.style.display = 'none';
                typewriterTextElement.style.display = 'block'; 

                initAudio(); // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º AudioContext
                
                await typewriterEffect(typewriterTextElement, introText, 40);
                startButton.style.display = 'block';

                startButton.addEventListener('click', startGame);
            }, { once: true });
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∫–æ–Ω–∫–∏ –Æ—Ä–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            speakerLeft.textContent = SPEAKER_ICONS["–Æ—Ä–∏–π"].icon;
        }

        initialize();
    </script>
</body>
</html>